from common import *

from trezor.crypto import beam

from apps.beam.helpers import (
    bin_to_str,
)

class TestBeamGenerateRangeproof(unittest.TestCase):
    mnemonic = "all all all all all all all all all all all all"
    seed = beam.from_mnemonic_beam(mnemonic)

    def test_generate_rangeproof(self):
        test_datasets = (
            # Test params:
            # (
            #     KIDV.idx, KIDV.type, KIDV.sub_idx, KIDV.value
            #     is_public_rangeproof,
            #     expected rangeproof
            # )
            (
                1, 2, 3, 4,
                False,
                "e07b3fb5f3fa1b3fd2cf7e7043f12c437489c16eb572ee31c610772edeb5fe2401c3333f901a2beb862b4858d59f7aea4b0978d396cae16cd4a5bf97c3d7a48e1101825de562c004e7485387e102c5677891384e14dda882ed4\
738919bb5780fc23c00a9d9317a8b026e0f2e56fafdc2e01638d89c12dbfc5c74bff4b567774f41016f000771bd241a49aa6f73c68a4e5c66f2f905b85e7bed3fb2b74912934f885324f045ad92e277748df5d901141e484f555e3f65fc209deed742\
9671eea4a0c89f74006530aff43cb1b873e77f7aba376ac6eaffa61d7e1763d7a32cdfdfdd0c6c66cc0179b94e85266852b459cb5d0c421004020c4d6a766b32b67a5b2db80b744bdb5901422d5bdf27999d63ac7e9dde0bdc2e718cad02d829addbd\
5c3132108dacc924100f2924ad698f641786464be59b979b8f73a081d4946c0e9bc00ef8df32e8da8f500ee99cbcb72e3c958f4a41d5da34b957dc12fdf78c337725f42d49183808116a000b4a0695fdc85766416732889a59cb21df6a7211a92ca07\
332e834087b486b083019b62e5457b4078fc0e978275d266dd160d87c4da893306ca7c297278b02feb1001e2231671f5f37cdafb32f5680b67f50772194000c09d87af2a955253a22d2329001d323b1bd64bb0490f78be6ab36b2d3beb70e1fad7c58\
d203236921ada7aa40a011f74281a315fdf2bc689d6a9a62cc8ea389a0ab4200e1ee04efe4b5fd538678f001766c12ddfa95f0c0878a938a632038fb0d297d5262c79755c62fa639c0905940199a99e4edfe6b3218e07db0c64ab5e60f3095cf8f803\
b8962dfeb8675af633a7d1a99857c11b26592b2a8b23dda679d8a2b398a30c1003e5c884513ded62c24318669dc6c4760281687f91ad4493a3262ad2a373ef0a2d3fa216adc9ee40bfbf01103585e8d34e73336b19f61845c6df7f1c4014a11c99482\
4b7ba42ce5bf844"
            ),
            (
                1, 11, 111, 23110,
                False,


                '2a44fb6cd5e465062feabe88fcbe0405abceac90eb04ba8dd21aae5fc6b8030101bf68a61abd528e5123cf2821139e0aa7af9ba394d62d7a331d30018eaee08948007084e76eb5297fff69811aed568a7d71234207e471b67153\
bd71d1cb1a5a746a010bb5c8a0055d878f8f4915f650e70280d129eff108062b909e55bdab19e4729d01f9f3c531a059dd45ecfacca651ef1a28275e811f8580b3a5a3c6dbb8fb8e5a2a0e4cf8cb2d70147f0d2b3628c94ac288cf3cea4e6d4b7efcb\
a63976deda5aed601abbc6d9f73a728685e0ced6fb6874b036e9211cbddeec538eacd68c489bdd8a000ebe4131c9bf9f979e8a32c474650c6913e13e063970c4db34954973d16c3cc30009a0642e36120597e61de2c351e6c751c65c62b89ef1bdb17\
0dceeeb0de1fb4e501894918a1bec4fcf5340d72993bae0f8aad57b8a53ea63ceffff38b4485d23ddb00c8e6d8008472958a9e7f416fc03285b4a6cca4d9a5c5279a9a60e4606bd18176002a0d52513e8e13804d8114c1e06181e1995fd3e87dd6bea\
ae60da226d29e2b1a0096c531227d48a773299cb8f21789e496e6966df9d1d638cd8386fed9bf4d9ccc01552cb8f33bcd98591ea5fba648886f383dc816641d07f5705e4685a0253fd2a301f1c3b231cb4bd6cd2c66c8ebbbc8f801c6046635f4e22f\
a9770f327b2094a88900d70fa2629d583c7e74e311347beccb266a5a709749ffec89168d95a377b284f101ab3b7da1357b4978fa4ce70d9b8e03f9a06b62d4441ef0c0fab2eb24f7b8291a00ca124343a08dd3d9539adb45a356d3d28129a07c3e6b9\
8e7fdeb6a76dbd47300183a2c54c18bf7ab967240ef04c4350e9c64c65be17a2afc7444d975c7bc286c0804555e6c08ab0aae70097f779d91547125d8701317d37baa562bc9399034dc4f08362e1537161166edd17d7cdbf23749d12fc6ca59a9189a\
190b6a48f40c81'
            ),
            (
                0, 0, 0, 3,
                False,
                'add55fb422565311a0940bcffb84d1a1fe5561263c41d0c5557fdb41bc62de0e00b2092f8aebf26c252f2e5609324286f6b1610c210b50bba4470e8e0f76068484011146a35c268477d60a92432dfaf38633e8c94eb88c88d420\
235d9dce3d2ab7e70171a9a46203336194078900390053efd05947f656339d44478b993d2b125e4a3300884bd1da5f13315f929d9cda40b4f3ddf89124c5514255f3eda19b9e51ffb4752fd3111d635563bafa8b4cd3fc858e4c4e7d87fe2744f2c55\
4a860d009e0154a012d667ec625c368e663e856ea61310fa58e7197d6a135d09e394baf15b789410401749403c00827547c189cdb8757fd3175b29343ecd1da89b0cfee98fec61b86a401d9284b52e85c43f6535a9a740f86106c948b62ceb1973f16\
7fd8521e5f61164001d053851eee209e72a2df5a7f314d170cecd7550939a3896d4e46d597623ca2fc0007f4819857c0cd5326c77ec24f82537270be96c08ac01f46db3cc690fdc483ae010f0805b64f9589baa57ac0fa4f25e21de87966c5e9f9320\
d9465382ac89b3df40190e7f97817dd3ece479122321593ffef20487601df681e80b8837deed98afd1a0026e8ac32ef097debef5fe051fa981dc05bcbf59d0749e3615111725bb79c00e9001a9cc2bb1d667c877b88dfcbb2f28feabca5022c44b63f\
ba8e8a0ff288dfe7ba0199ed51ce3651ac8c3d144662723db16768186f5c1fee2e2818407353d7a64cf401b290d7dfae00c75f9261ee044795cf375dc5b51ae482de7e3770ea1ecba1556500f0936899d729dfa5425e34dd21b58c73ac28784794c0a\
27a6feb809a9591e9120dc0bb6acac4f8b8a3a9fd2881264b9b80cf0312a97429c185a77818720b800a8fc7d196c8705fb9fbb25c0df0d0c96ee45fe086ae5833943d2458967828bc38ca1885d0f6edb4f8254ae098edb83fa372410de51f55c46bea\
1c0c90b54fe6b1'
            ),
        )

        for test_params in test_datasets:
            kid_idx = test_params[0]
            kid_type = test_params[1]
            kid_sub_idx = test_params[2]
            kid_value = test_params[3]
            is_public_rangeproof = int(test_params[4])
            expected_rangeproof = test_params[5]

            is_public_rangeproof = 0
            asset_id = bytearray(0)
            rangeproof_data = bytearray(688)
            beam.generate_rp_from_key_idv(kid_idx, kid_type, kid_sub_idx, kid_value,
                                          asset_id, is_public_rangeproof, self.seed,
                                          rangeproof_data)

            self.assertEqual(bin_to_str(rangeproof_data), expected_rangeproof)


if __name__ == '__main__':
    unittest.main()

